<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Playtomic: AS3 API documentation</title>
	<meta name="description" content="Free, open source, self-hosted leaderboards and more for Flash games.">
	<link href='../css/bootstrap/bootstrap.min.css' rel='stylesheet' type='text/css'>
	<link href='../css/custom.css' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800' rel='stylesheet' type='text/css'>
	<link rel="icon" href="/favicon.ico" type="image/icon" />
</head>
<body>

	<div id="sponsor">
		<div class="container">
			Sponsor this initiative and share your message with game developers everywhere.  <a href="mailto:benlowry@outlook.com">email</a>
		</div>
	</div>
	
	<header>
		<div class="container">
			<a href="http://playtomic.org/"><img src="../assets/playtomic.png" alt="Playtomic" title="Playtomic" /></a>
			<ul>
				<li><a href="/">Home</a></li>		
				<li><a href="http://igg.me/at/playtomic">Contribute</a></li>		
				<li><a href="/server.html">Server setup</a></li>
				<li><a href="/apis.html">API documentation</a></li>
				<li><a href="https://github.com/playtomic">Github</a></li>
				<li><a href="https://twitter.com/playtomic">Twitter</a></li>
				<li><a href="http://lvlboost.com/">Game analytics</a></li>
			</ul>
		</div>
	</header>
		
	<div id="content2">
				
		<div class="row">
			
			<div class="span3">
		
				<div class="docnav">
					<h2>API Sections</h2>
					<ul>
						<li><a href="#settingup">Setting up</a></li>
						<li><a href="#leaderboards">Leaderboards</a></li>
						<li><a href="#playerlevels">Player levels</a></li>
						<li><a href="#gamevars">GameVars</a></li>
						<li><a href="#geoip">GeoIP</a></li>
					</ul>
				
					<h2>API documentation</h2>
					<ul>
						<li><a href="as3.html">ActionScript 3</a></li>
						<li><a href="android.html">Android / Java</a></li>
						<li><a href="html5.html">HTML5 / JavaScript</a></li>
						<li><a href="ios.html">iOS / Objective C</a></li>
						<li><a href="csharp.html">Mono and .NET</a></li>
						<li><a href="unity3d.html">Unity3d</a></li>
					</ul>
					
					<h2>Supplements</h2>
					<ul>
						<li><a href="errorcodes.html">Error codes</a></li>
					</ul>
				</div>
			
			</div>
			
			<div class="span7">
				
				<a name="settingup"></a>
				<div class="section">
					
					<h1>Flash / ActionScript 3 API</h1>
					
					<h2>Downloading the API</h2>
					<p>You can either <a href="https://github.com/playtomic/gameapi-as3/archive/master.zip">download the zip</a> or if you're a git user <a href="https://github.com/playtomic/gameapi-as3">clone the repository</a>.</p>

					<h2>Initializing the API</h2>
					<p>Before using the API you must initialize it with your public and private keys.  Your	keys need to be created in your database.</p>
						
					<pre>Playtomic.initialize(publickey:String, privatekey:String, apiurl:String);</pre>
					<p>Your apiurl will be in the format http://your-application-name.herokuapp.com/ or similar.</p>
					
					<p>To import the packages in your game copy the 'com' folder to your project and in your class:</p>
					<pre>import com.playtomic.as3.*;</pre>

					<h2>Examples</h2>
					<p>Each API has an extensive test library in the source code that demonstrates how to use every part in a variety of ways.</p>
					
				</div>
				
				<a name="leaderboards"></a>
				<div class="section">
					
					<h2>Leaderboards</h2>
					<p>The Leaderboards API gives you very flexible high and low score leaderboards. They can be 
						created in your game dynamically or set up in the edit leaderboards page.</p>

					<h2>Score structure</h2>
					<table class="table table-striped">
						<tr>
							<th>Property</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
						<tr>
							<td>name</td>
							<td>String</td>
							<td>The player name.  This can be by the player or provided by any 3rd party</td>
						</tr>
						<tr>
							<td>playerid</td>
							<td>String</td>
							<td>Facebook or other userids, used for filtering by friends.</td>
						</tr>
						<tr>
							<td>points</td>
							<td>number</td>
							<td>The player's score</td>
						</tr>
						<tr>
							<td>source</td>
							<td>String</td>
							<td>The website or device the score occurred on</td>
						</tr>
						<tr>
							<td>fields</td>
							<td>Object</td>
							<td>Any additional data you want to (or have) attached to a score.</td>
						</tr>
						<tr>
							<th colspan="3">Properties set by the API server</th>
						</tr>
						<tr>
							<td>date</td>
							<td>Date</td>
							<td>The date of the score</td>
						</tr>
						<tr>
							<td>rdate</td>
							<td>String</td>
							<td>The relative date of the score eg "7 minutes ago"</td>
						</tr>
						<tr>
							<td>rank</td>
							<td>int</td>
							<td>The rank based on your listing parameters.</td>
						</tr>
						<tr>
							<th colspan="3">Table detais</th>
						</tr>
						<tr>
							<td>table</td>
							<td>String</td>
							<td>The name of the score table</td>
						</tr>
						<tr>
							<td>highest</td>
							<td>Boolean</td>
							<td>The sort ordering by highest or lowest</td>
						</tr>
						<tr>
							<td>allowduplicates</td>
							<td>Boolean</td>
							<td>Create duplicates, or override or reject scores if they're not the best</td>
						</tr>
					</table>

						<h2>Submitting scores</h2>
						<p>Score submission is handled by:</p>
						<pre>Leaderboards.save(score:Object, callback:Function=null);</pre>
						
<pre>function submitScore(e:MouseEvent):void
{
	// basic score
    var score:Object = {
		name: "ben",
		points: 173000,
		table: "highscores",
		allowduplicates: true
	};
	
    Leaderboards.save(score, submitComplete); 

    // another score
    var score2:Object = {
		name: "ben",
		points: 173000,
		table: "highscores",
		allowduplicates: true,
		source: root.loaderInfo.loaderURL,
		fields: {
			character: "barbarian",
			level: 7,
			kills: 18
		}
	};
	
    Leaderboards.save(score2, submitComplete);
}

function submitComplete(response:Object):void
{
    if(response.success)
    {
        trace("Score saved!");		
    }
    else
    {
        // submission failed because of response.errorMessage with response.errorcode
    }
}</pre>

		
					<h2>Showing scores</h2>
					<p>Scores are loaded via a simple method that returns an array of 
					scores to your function where you can display the data in your leaderboard.</p>
					
					<pre>Leaderboards.list(options:Object, callback:Function);</pre>
			
					<table class="table table-striped">
						<tr>
							<th>Property</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
						<tr>
							<td>table</td>
							<td>String</td>
							<td>The name of the score table</td>
						</tr>
						<tr>
							<td>highest</td>
							<td>Boolean</td>
							<td>The sort ordering by highest or lowest</td>
						</tr>
						<tr>
							<td>allowduplicates</td>
							<td>Boolean</td>
							<td>Reject scores if they're not the player's best (default false) or allow multiple scores per player</td>
						</tr>
						<tr>
							<td>filters</td>
							<td>Object</dt>
							<td>Additional properties to filter by from the 'save' fields</td>
						</tr>
						<tr>
							<td>source</td>
							<td>String</td>
							<td>The website or device the score occurred on</td>
						</tr>
						<tr>
							<td>friendslist</td>
							<td>String[]</td>
							<td>Array of friend's playerids</td>
						</tr>
						<tr>
							<td>playerid</td>
							<td>String</td>
							<td>A specific playerid</td>
						</tr>
						<tr>
							<td>excludeplayerid</td>
							<td>Boolean</td>
							<td>For excluding the playerid as a filter when SaveAndListing</td>
						</tr>
						<tr>
							<td>mode</td>
							<td>String</td>
							<td>Time limits, 'last7days', 'last30days', 'alltime' (default), 'today' and 'newest' which returns latest unsorted scores.</td>
						</tr>
						<tr>
							<th colspan="3">Pagination</th>
						</tr>
						<tr>
							<td>page</td>
							<td>int</td>
							<td>Page number to return (default is 1)</td>
						</tr>
						<tr>
							<td>perpage</td>
							<td>int</td>
							<td>Results per page (default is 20)</td>
						</tr>
					</table>
					
<pre>function showScores(e:MouseEvent):void
{
	// table options
	var table:Object = {
		table: "highscores",
		page: 1,
		perpage: 10,
		highest: true
	};
	
    Leaderboards.list(table, listComplete);
}

function listComplete(scores:Array, numscores:int, response:Object):void
{
    if(response.success)
    {
        trace(scores.length + " scores returned out of " + numscores);

        for(var i:int=0; i&lt;scores.length; i++)
        {
            var score:Object = scores[i];
            trace(" - " + score.name + " got " + score.points + " on " + score.sdate);

            // including custom data?  score.fields.property
        }
    }
    else
    {
        // score listing failed because of response.errorMessage with response.errorcode
    }
}</pre>
					
					<h2>Save and list</h2>
					<p>You can submit scores and at the same time return the leaderboard page that that score is on.
						This combines the Save and List approaches from above:</p>
						
					<pre>Leaderboards.saveAndList(score:Object, callback:Function)</pre>
					
					<p>Note:  If you pass a 'playerid' to be saved you can exclude it from filtering the returned
						scores via the additional option, excludeplayerid = true</p>

					<p>You don't specify a 'page', you specify the 'perpage' (default 20) and it will automatically 
						decide which page to return based on the submitted score's rank. If you submit the 1187th 
						best score at 30 per page then it will show you page 39, scores #1170 - #1200.</p>
					<p>Ranks are returned so you are not viewing the top N scores you are viewing the top N scores 
						from rank X onwards.</p>				
					
				</div>
				
				<a name="playerlevels"></a>
				<div class="section">
					
					<h2>Level sharing</h2>
					
					<p>The level sharing API provides a way to store and retrieve user-generated content for your game. 
						It can operate anonymously or authenticated via any 3rd party service you're already using.</p>

					<h3>Level structure</h3>
					<p>Saving and listing levels uses this class to represent a level.</p>

					<table class="table table-striped">
						<tr>
							<th>Property</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
						<tr>
							<td>name</td>
							<td>String</td>
							<td>The level name.</td>
						</tr>
						<tr>
							<td>playername</td>
							<td>String</td>
							<td>The player name.</td>
						</tr>
						
						<tr>
							<td>playerid</td>
							<td>String</td>
							<td>Facebook or other userids, used for filtering by friends.</td>
						</tr>
						<tr>
							<td>data</td>
							<td>String</td>
							<td>The created level data as a string</td>
						</tr>
						<tr>
							<td>source</td>
							<td>String</td>
							<td>The website or device the score occurred on</td>
						</tr>
						<tr>
							<td>fields</td>
							<td>Object</td>
							<td>Any additional data you want to (or have) attached to a level.</td>
						</tr>
					</table>
					
					<h2>Saving levels</h2>
					<pre>PlayerLevels.save(level:Object, callback:Function=null);</pre>
					<p>Example saving level:</p>

<pre>function saveLevel(e:MouseEvent):void
{
    var level:Object = {
		name: "My level",
		data: "obj1=cannon&amp;obj1x=120&amp;obj1y=180",
		playername: "Ben"
	}
	
    PlayerLevels.save(level, saveComplete);
}

function saveComplete(level:Object, response:Object):void
{
    if(response.success)
    {
        trace("Level saved successfully, the level id is " + level.levelid);
    }
    else
    {
        // failed because of response.errorMessage with response.errorcode
    }
}</pre>
					
					<h2>Rating levels</h2>
					<p>Levels can be rated 1 - 10 by players. Rating can be done anonymously with some 
						protection against repeat voting, or bound to playerids if you specify them.</p>
						
					<pre>PlayerLevels.rate(levelid:String, rating:int, callback:Function=null);</pre>
					
					<p>Example rating level:</p>

<pre>function rate(e:MouseEvent):void
{
    PlayerLevels.rate(level.levelid, 8, rateComplete);
}

function rateComplete(response:Object):void
{
    if(response.success)
    {
        trace("Rating complete"");
    }
    else
    {
        // Rating failed because of response.errorMessage with response.errorcode
    }
}</pre>
					
					<h2>Listing levels</h2>
					<p>	Listing levels can be done by popular or newest, with optional 
						filtering by date ranges and/or custom fields.</p>

					<pre>PlayerLevels.list(options:Object, callback:Function);</pre>
					
					<h4>Listing options</h4>
					<table class="table table-striped">
						<tr>
							<th>Property</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
						<tr>
							<td>mode</td>
							<td>String</td>
							<td>'newest' or 'popular'.</td>
						</tr>
						<tr>
							<td>datemin</td>
							<td>String</td>
							<td>'mm/dd/yyyy' for the minimum date the level was created.</td>
						</tr>
						<tr>
							<td>datemax</td>
							<td>String</td>
							<td>'mm/dd/yyyy' for the maximum date the level was created.</td>
						</tr>
						<tr>
							<td>playerid</td>
							<td>String</td>
							<td>Facebook or other userid</td>
						</tr>
						<tr>
							<td>friendslist</td>
							<td>String[]</td>
							<td>Array of friend's playerids</td>
						</tr>
						<tr>
							<td>data</td>
							<td>Boolean</td>
							<td>Return the level data with the request (maybe faster to load individually)</td>
						</tr>
						<tr>
							<td>source</td>
							<td>String</td>
							<td>The website or device the level was created on</td>
						</tr>
						<tr>
							<td>filters</td>
							<td>Object</td>
							<td>Any additional data you want to (or have) attached to a level.</td>
						</tr>
						<tr>
							<th colspan="3">Pagination</th>
						</tr>
						<tr>
							<td>page</td>
							<td>int</td>
							<td>Page number to return (default is 1)</td>
						</tr>
						<tr>
							<td>perpage</td>
							<td>int</td>
							<td>Results per page (default is 20)</td>
						</tr>
					</table>
	
					
					<p>An example listing levels:</p>

<pre>function list(e:MouseEvent):void
{
	var listoptions:Object = {
		mode: "newest",
		data: false,
		perpage: 30,
		filters: {
			difficulty: "hard"
		}
	};
	
    PlayerLevels.list(listoptions, listLoaded);
}

function listLoaded(levels:Array, numlevels:int, response:Object):void
{
    if(response.success)
    {
        for(var i:int=0; i&lt;levels.length; i++)
        {
            trace(" - " + levels[i].levelid + ": " + levels[i].name);
        }
    }
    else
    {
        // Level list failed to load because of response.errorMessage with response.errorcode
    }
}</pre>
					
					<h2>Loading levels</h2>
					<p>If you do not include the data when you load lists of levels then you can request it seperately.</p>

					<pre>PlayerLevels.load(levelid:String, callback:Function)</pre>
					
					<p>An example loading a single level:</p>

<pre>function load(e:MouseEvent):void
{
    PlayerLevels.load(level.levelid, loadComplete);
}

function loadComplete(level:Object, response:Object):void
{
    if(response.success)
    {
        trace("Level has been loaded, now you can begin playing it");
    }
    else
    {
        // level failed to load because of response.errorMessage with response.errorcode
    }
}</pre>
					
				</div>
				
				<a name="gamevars"></a>
				<div class="section">
					<h2>GameVars</h2>
					<p>GameVars let you change the value of key variables in your game any time you 
						want.</p>
						
					<h3>Setting them up in your database</h3>
					<p>In your <a href="https://mongohq.com/">MongoHQ</a> dashboard add a new entry
						to the "gamevars" collection.</p>
						
<pre>{
	name: "basehitpoints",
	value: 800
}</pre>
						
					<h2>Loading</h2>
					<p>They are loaded via:</p>
					
					<pre>GameVars.load(callback:Function);</pre>
					
					<p>You can load variables individually, for instance if you are caching the 
						GameVars you can check a 'version' GameVar to decide whether to reload 
						the full collection.</p>
						
					<pre>GameVars.loadSingle("name", callback);</pre>
					
					<p>The callback parameter is your function that receives an object that 
						has properties matching the variables you have configured in your database. 
						The callback is the same for all or single GameVars.</p>
						
<pre>// our variables with default, original values
var basehitpoints:int = 100;
var basegold:int = 50;

function InitialiseGame():void
{
    // load GameVars
    GameVars.load(gameVarsLoaded);
    // or GameVars.loadSingle("basehitpoints", gameVarsLoaded);

    // carry on initializing your game
}

function gameVarsLoaded(vars:Object, response:Object):void
{
    if(response.success)
    {
        // sync the in-game variables
        basehitpoints = vars.basehitpoints;
        basegold = vars.basegold;
    }
    else
    {
        // request failed because of response.errorMessage with response.errorcode
    }
}</pre>
				</div>
				
				<a name="geoip"></a>
				<div class="geoip">
					<h2>Geolocation</h2>
					<p>The GeoIP service identifies which country the player is from, 
						returning their country code and name.</p>
					<p>It is called via:</p>

					<pre>GeoIP.lookup(callback);</pre>
					
					<p>The callback function receives an object that has 'code' and 'name' properties:</p>
						
<pre>GeoIP.lookup(setPlayerCountry);
	
function setPlayerCountry(country:Object, response:Object):void
{
    if(response.success)
    {
        // we have the country data
        trace("Player is from " + country.code + " / " + country.name);
    }
    else
    {
        // request failed because of response.errorMessage with response.errorcode
    }
}</pre>
				</div>
					
			</div>
		</div>
	</div>
	

	<footer>
		<div class="container">
			&copy; 2013 <a href="http://lvlboost.com/">lvlboost</a>.  Server and client software are released under the <a href="http://opensource.org/licenses/MIT">MIT license</a>.
		</div>
	</footer>
	
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-40077834-4', 'playtomic.org');
	  ga('send', 'pageview');

	</script>
	
</body>
</html>